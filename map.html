<!DOCTYPE html>
<html>
<head>
    <title>API Name Scanner</title>
    <script src="https://live.zwidgets.com/js-sdk/1.2/ZohoEmbededAppSDK.min.js"></script>
    <style>
        body { font-family: monospace; padding: 20px; background: #f4f4f4; }
        #scanner-box { 
            background: white; 
            border: 2px solid #333; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto; 
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        h2 { border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .field-row { 
            border-bottom: 1px solid #eee; 
            padding: 5px 0; 
            display: flex; 
        }
        .field-name { 
            font-weight: bold; 
            color: #0066cc; 
            width: 40%; 
        }
        .field-value { 
            color: #333; 
            width: 60%; 
            word-break: break-all; 
        }
        .highlight { background-color: #fff3cd; font-weight: bold; }
    </style>
</head>
<body>

    <div id="scanner-box">
        <h2>Record API Name Scanner</h2>
        <div id="status">Connecting to Zoho...</div>
        <hr>
        <div id="field-list">Waiting for data...</div>
    </div>

    <script>
        ZOHO.embeddedApp.on("PageLoad", function(data){
            if(data && data.EntityId){
                fetchData(data.EntityId);
            }
        });

        ZOHO.embeddedApp.init().then(function(){
            console.log("Init successful");
        });

        async function fetchData(id) {
            document.getElementById('status').innerText = "Fetching Record ID: " + id;
            
            try {
                const response = await ZOHO.CRM.API.getRecord({Entity: "Referrals", RecordID: id});
                
                if(response.data && response.data.length > 0) {
                    const record = response.data[0];
                    document.getElementById('status').innerText = "Data Loaded. Scrolling for Address fields...";
                    renderFields(record);
                }
            } catch (e) {
                document.getElementById('status').innerText = "Error: " + JSON.stringify(e);
            }
        }

        function renderFields(record) {
            const list = document.getElementById('field-list');
            list.innerHTML = ""; // Clear
            
            // Sort keys alphabetically to make it easier to find "C"
            const keys = Object.keys(record).sort();

            keys.forEach(key => {
                let val = record[key];
                
                // Handle objects (like Picklists)
                if (val && typeof val === 'object') {
                    val = JSON.stringify(val);
                }

                const row = document.createElement('div');
                row.className = "field-row";
                
                // Highlight potential address fields
                if(key.includes("State") || key.includes("Street") || key.includes("Address")) {
                    row.classList.add("highlight");
                }

                row.innerHTML = `
                    <div class="field-name">${key}</div>
                    <div class="field-value">${val}</div>
                `;
                list.appendChild(row);
            });
        }
    </script>
</body>
</html>
