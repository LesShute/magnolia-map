<!DOCTYPE html>
<html>
<head>
    <title>Diagnostic Mode</title>
    <script src="https://live.zwidgets.com/js-sdk/1.2/ZohoEmbededAppSDK.min.js"></script>
    <style>body { font-family: monospace; padding: 20px; }</style>
</head>
<body>
    <h2>Data Connection Diagnostic</h2>
    <div id="status">Initializing...</div>
    <hr>
    <pre id="output">Waiting for Zoho Handshake...</pre>

    <script>
        ZOHO.embeddedApp.on("PageLoad", function(data){
            // Just listening
        });

        ZOHO.embeddedApp.init().then(function(){
            document.getElementById('status').innerHTML = "Handshake Successful. Querying Database...";
            runDiagnostics();
        });

        async function runDiagnostics() {
            const logArea = document.getElementById('output');
            
            // TEST 1: Try "Providers" (Custom Module Name)
            try {
                logArea.innerText += "\nAttempting fetch: Entity = 'Providers'...";
                const response = await ZOHO.CRM.API.getAllRecords({Entity: "Providers", sort_order:"asc", per_page: 1});
                
                if(response.data) {
                    alert("SUCCESS! Found module 'Providers'.\n\nFirst Record Name: " + response.data[0].Name + "\n\nCheck the screen for API Keys.");
                    
                    // PRINT THE RAW KEYS so we see the Real API Names
                    logArea.innerText += "\n\n[SUCCESS] Module 'Providers' exists.";
                    logArea.innerText += "\n\n=== RAW DATA KEYS (First Record) ===";
                    logArea.innerText += "\n" + JSON.stringify(response.data[0], null, 4);
                    return; // Stop if successful
                } else {
                    logArea.innerText += "\n[FAILURE] Module 'Providers' returned no data (or is invalid).";
                }
            } catch (e) {
                logArea.innerText += "\n[ERROR] 'Providers' query failed: " + JSON.stringify(e);
            }

            // TEST 2: Try "Vendors" (Standard Module Name)
            try {
                logArea.innerText += "\n\nAttempting fetch: Entity = 'Vendors'...";
                const responseV = await ZOHO.CRM.API.getAllRecords({Entity: "Vendors", sort_order:"asc", per_page: 1});
                
                if(responseV.data) {
                    alert("SUCCESS! Found module 'Vendors'.\n\n(You likely renamed the standard Vendors module to Providers).");
                    logArea.innerText += "\n\n[SUCCESS] Module 'Vendors' exists.";
                    logArea.innerText += "\n\n=== RAW DATA KEYS (First Record) ===";
                    logArea.innerText += "\n" + JSON.stringify(responseV.data[0], null, 4);
                } else {
                    logArea.innerText += "\n[FAILURE] Module 'Vendors' returned no data.";
                }
            } catch (e) {
                logArea.innerText += "\n[ERROR] 'Vendors' query failed: " + JSON.stringify(e);
            }
            
            // TEST 3: Try "CustomModule1" (Common Default)
            // Sometimes custom modules get generic API names
            logArea.innerText += "\n\n(If both failed, check Setup > APIs > API Names for the 'Providers' module)";
        }
    </script>
</body>
</html>
